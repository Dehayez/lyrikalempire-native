"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[385],{1385:(e,t,o)=>{o.d(t,{default:()=>r});const n=window.fetch,a=XMLHttpRequest.prototype.open,s=XMLHttpRequest.prototype.send;class i{constructor(){this.isEnabled=!1,this.latency=0,this.downloadSpeed=1/0,this.uploadSpeed=1/0,this.originalFetch=n,this.originalXHROpen=a,this.originalXHRSend=s,this.isIntercepted=!1}enable(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{latency:t=100,downloadSpeed:o=1048576,uploadSpeed:n=524288,packetLoss:a=0}=e;this.isEnabled=!0,this.latency=t,this.downloadSpeed=o,this.uploadSpeed=n,this.packetLoss=a,this.isIntercepted||(this.interceptFetch(),this.interceptXHR(),this.isIntercepted=!0),console.log("[Network Throttle] Enabled - Latency: ".concat(t,"ms, Download: ").concat(this.formatSpeed(o),", Upload: ").concat(this.formatSpeed(n)))}disable(){this.isEnabled=!1,this.isIntercepted&&(window.fetch=n,XMLHttpRequest.prototype.open=a,XMLHttpRequest.prototype.send=s,this.isIntercepted=!1)}interceptFetch(){const e=this;window.fetch=async function(){for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];if(!e.isEnabled)return n.apply(window,o);try{const[,t]=o;let n=0;const a=null==t?void 0:t.body;var s;a&&(a instanceof Blob?n=a.size:"string"==typeof a?n=a.length:(a instanceof ArrayBuffer||null!==(s=ArrayBuffer.isView)&&void 0!==s&&s.call(ArrayBuffer,a))&&(n=a.byteLength));const i=n/e.uploadSpeed*1e3,r=Math.max(0,e.latency+(isFinite(i)?i:0));r>0&&await e.delay(r)}catch(t){await e.delay(e.latency)}if(Math.random()<e.packetLoss)throw new Error("Network Error: Packet Loss Simulated");try{var i,r;const t=await n.apply(window,o);if(t.body&&isFinite(e.downloadSpeed)){const o=t.body.getReader(),n=[];for(;;){const{done:t,value:a}=await o.read();if(t)break;n.push(a);const s=a.length/e.downloadSpeed*1e3;s>0&&await e.delay(s)}const a=new Blob(n);return new Response(a,{status:t.status,statusText:t.statusText,headers:t.headers})}const a=null===(i=t.headers)||void 0===i||null===(r=i.get)||void 0===r?void 0:r.call(i,"content-length"),s=a?parseInt(a,10):0;if(s>0&&isFinite(e.downloadSpeed)){const t=s/e.downloadSpeed*1e3;t>0&&await e.delay(t)}return t}catch(e){throw console.error("[Network Throttle] Fetch error:",e),e}}}interceptXHR(){const e=this;XMLHttpRequest.prototype.open=function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return this._throttleConfig={startTime:performance.now(),url:t[1]},a.apply(this,t)},XMLHttpRequest.prototype.send=function(t){if(!e.isEnabled)return s.call(this,t);const o=this;if(Math.random()<e.packetLoss)return void setTimeout((()=>{try{o.abort()}catch(e){}}),e.latency);let n=0;try{var a;t&&(t instanceof Blob?n=t.size:"string"==typeof t?n=t.length:(t instanceof ArrayBuffer||null!==(a=ArrayBuffer.isView)&&void 0!==a&&a.call(ArrayBuffer,t))&&(n=t.byteLength))}catch(e){}const i=n/e.uploadSpeed*1e3,r=Math.max(0,e.latency+(isFinite(i)?i:0));setTimeout((()=>{s.call(o,t)}),r)}}delay(e){return new Promise((t=>setTimeout(t,e)))}formatSpeed(e){return e>=1048576?"".concat((e/1048576).toFixed(1),"MB/s"):e>=1024?"".concat((e/1024).toFixed(1),"KB/s"):"".concat(e.toFixed(0),"B/s")}getStatus(){return{isEnabled:this.isEnabled,latency:this.latency,downloadSpeed:this.downloadSpeed,uploadSpeed:this.uploadSpeed,packetLoss:this.packetLoss}}static getPresets(){return{"Fast 3G":{latency:100,downloadSpeed:1572864,uploadSpeed:768e3,packetLoss:.01},"Slow 3G":{latency:300,downloadSpeed:798720,uploadSpeed:337920,packetLoss:.02},"2G":{latency:500,downloadSpeed:256e3,uploadSpeed:51200,packetLoss:.05},"Dial-up":{latency:1e3,downloadSpeed:57344,uploadSpeed:33792,packetLoss:.1}}}getPresets(){return i.getPresets()}}const r=new i}}]);
//# sourceMappingURL=385.bundle.js.map