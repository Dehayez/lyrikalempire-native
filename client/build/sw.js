const CACHE_NAME="lyrikal-empire-v1",AUDIO_CACHE_NAME="lyrikal-empire-audio-v1",ESSENTIAL_ASSETS=["/","/static/js/bundle.js","/static/css/main.css","/manifest.json","/android-chrome-192x192.png","/android-chrome-512x512.png"];async function handleBackgroundAudio(e){(await self.clients.matchAll({type:"window"})).forEach((t=>{t.postMessage({type:"BACKGROUND_AUDIO_PLAY",data:e})}))}async function pauseBackgroundAudio(){(await self.clients.matchAll({type:"window"})).forEach((e=>{e.postMessage({type:"BACKGROUND_AUDIO_PAUSE"})}))}async function skipTrack(e){(await self.clients.matchAll({type:"window"})).forEach((t=>{t.postMessage({type:"BACKGROUND_SKIP_TRACK",direction:e})}))}async function syncAudioQueue(){(await self.clients.matchAll({type:"window"})).forEach((e=>{e.postMessage({type:"SYNC_AUDIO_QUEUE"})}))}self.addEventListener("install",(e=>{e.waitUntil(caches.open(CACHE_NAME).then((e=>e.addAll(ESSENTIAL_ASSETS))).then((()=>self.skipWaiting())))})),self.addEventListener("activate",(e=>{e.waitUntil(caches.keys().then((e=>Promise.all(e.map((e=>{if(e!==CACHE_NAME&&e!==AUDIO_CACHE_NAME)return caches.delete(e)}))))).then((()=>self.clients.claim())))})),self.addEventListener("fetch",(e=>{const{request:t}=e;t.url.includes("/audio/")||t.url.includes(".mp3")||t.url.includes(".aac")?e.respondWith(caches.open(AUDIO_CACHE_NAME).then((e=>e.match(t).then((a=>a||fetch(t).then((a=>(a.ok&&e.put(t,a.clone()),a)))))))):e.respondWith(caches.match(t).then((e=>e||fetch(t))))})),self.addEventListener("message",(e=>{const{type:t,data:a}=e.data;switch(t){case"PLAY_AUDIO":handleBackgroundAudio(a);break;case"PAUSE_AUDIO":pauseBackgroundAudio();break;case"SKIP_TRACK":skipTrack(a.direction)}})),self.addEventListener("sync",(e=>{"background-audio-sync"===e.tag&&e.waitUntil(syncAudioQueue())})),self.addEventListener("push",(e=>{if(e.data){const t=e.data.json();"audio-control"===t.type&&e.waitUntil(self.registration.showNotification(t.title,{body:t.body,icon:"/android-chrome-192x192.png",badge:"/android-chrome-192x192.png",actions:[{action:"play",title:"Play"},{action:"pause",title:"Pause"},{action:"next",title:"Next"}],tag:"audio-control",renotify:!0,silent:!0}))}})),self.addEventListener("notificationclick",(e=>{e.notification.close(),"play"===e.action?clients.matchAll({type:"window"}).then((e=>{e.forEach((e=>{e.postMessage({type:"PLAY_FROM_NOTIFICATION"})}))})):"pause"===e.action?clients.matchAll({type:"window"}).then((e=>{e.forEach((e=>{e.postMessage({type:"PAUSE_FROM_NOTIFICATION"})}))})):"next"===e.action?clients.matchAll({type:"window"}).then((e=>{e.forEach((e=>{e.postMessage({type:"NEXT_FROM_NOTIFICATION"})}))})):clients.openWindow("/")}));